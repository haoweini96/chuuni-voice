# chuuni-voice

> Give your AI coding assistant the voice of an anime hero.

`chuuni-voice` plays Japanese character voice clips at key moments while you code with [Claude Code](https://claude.ai/code) — task start, test pass, bash runs, errors, and more. Drop in any audio files, swap characters with one command, and optionally route audio through an RVC voice model.

---

## Features

- **8 coding events** — hooks into Claude Code's lifecycle via `~/.claude/settings.json`
- **Character system** — swap between named characters; each has its own audio folder and optional custom lines
- **Flexible file naming** — supports `task_done.mp3`, `日语_genki-girl_task_done.mp3`, and `japanese_*_genki-girl_task_done.mp3` with priority-based resolution
- **RVC-ready** — optional voice conversion via a local RVC WebUI instance (pre-converted clips work out of the box)
- **Zero dependencies at runtime** — pure stdlib playback on macOS (`afplay`); Linux falls back through `paplay → aplay → mpg123`

---

## Quick Start

```bash
pip install chuuni-voice

# Interactive setup wizard
chuuni init

# Inject hooks into Claude Code
chuuni hook

# Drop audio files into your character's folder
# (see "Character Packs" below for naming rules)
ls ~/.config/chuuni/characters/my-character/

# Switch to your character
chuuni character use my-character

# Test any event manually
chuuni play task_done
```

Run `chuuni status` at any time to see which files are loaded and which player binary is active.

---

## Events

| Event | Triggered when | Default line |
|-------|---------------|--------------|
| `task_start` | Claude receives a new task (`Task` tool / `Notification` hook) | 参る！ |
| `coding` | Claude writes or edits a file (`Write`, `Edit`, `MultiEdit`) | コードよ…俺の意志に従え！ |
| `bash_run` | Claude runs a shell command (`Bash` tool) | シェルよ、我が命令を刻め！ |
| `test_pass` | Bash command exits with code 0 | 完璧だ…！全てが意図通りに…！ |
| `test_fail` | Bash command exits with non-zero code | くっ…テストに阻まれるとは… |
| `error` | Claude hits a tool error | くっ…予想外の敵か |
| `task_done` | Claude finishes a task (`Stop` hook) | 任務完了。世界は救われた |
| `thinking` | Claude sends a notification (thinking/waiting state) | 深淵を覗いている… |

---

## Character Packs

Each character lives in its own directory under `~/.config/chuuni/characters/`:

```
~/.config/chuuni/characters/
└── my-character/
    ├── character.toml          # metadata + custom lines (optional)
    ├── task_done.mp3           # generic format
    ├── 日语_my-character_coding.mp3        # named format (priority 1)
    └── japanese_Cool-Voice_my-character_task_start.mp3  # long-name format (priority 2)
```

### File naming — priority order

| Priority | Format | Example |
|----------|--------|---------|
| 1 | `日语_<charname>_<event>.<ext>` | `日语_genki-girl_task_done.mp3` |
| 2 | `japanese_*<charname>_<event>.<ext>` | `japanese_Amazing-anime-girl_genki-girl_coding.mp3` |
| 3 | `<event>.<ext>` / `<event>_*.<ext>` | `task_done.mp3`, `error_2.wav` |

When multiple files match the same priority tier and event, one is chosen at random each time.
Supported extensions: `.mp3` `.wav` `.ogg` `.aiff` `.flac`

### character.toml

```toml
[character]
name         = "my-character"
display_name = "我がキャラ"
description  = "A brief description shown in chuuni character list"
rvc_model    = ""   # optional: .pth filename for RVC conversion

[lines]
# Each event takes a list; one is chosen at random.
# Omit any key to fall back to the built-in chuuni lines.
task_start = ["よし、行くぞ！", "俺に任せろ！"]
coding     = ["このコード、俺が書く！"]
bash_run   = ["全システム起動！"]
test_pass  = ["完璧だ！"]
test_fail  = ["まだだ、諦めない！"]
error      = ["くそっ！"]
task_done  = ["やり遂げたぞ！"]
thinking   = ["考え中…"]
```

### Switch characters

```bash
chuuni character list          # show all installed characters
chuuni character use genki-girl
```

---

## Configuration

`~/.config/chuuni/config.toml` — generated by `chuuni init`:

```toml
active_character = "my-character"
volume           = 0.8          # 0.0 – 1.0
enabled          = true
cooldown_seconds = 3.0          # minimum seconds between same-event plays
```

---

## RVC Voice Conversion

If you have a local [RVC WebUI](https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI) running on port 7865, `chuuni-voice` can convert audio on the fly.

```toml
# in ~/.config/chuuni/config.toml
rvc_model_path = "~/.config/chuuni/models/my-voice.pth"
rvc_index_path = "~/.config/chuuni/models/my-voice.index"   # optional
```

Pre-converted clips are always preferred — RVC conversion is only a fallback path for clips that haven't been converted yet.

---

## Hooks

`chuuni hook` injects the following into `~/.claude/settings.json` (backs up the original first):

```json
{
  "hooks": {
    "PreToolUse":  ["..."],   // task_start, coding, bash_run, thinking
    "PostToolUse": ["..."],   // task_done, test_pass / test_fail (exit code)
    "Stop":        ["..."],   // task_done
    "Notification":["..."]    // task_start
  }
}
```

Run `chuuni hook --remove` to cleanly uninstall all hooks.

---

## Contributing

### Making a character pack

1. Create `~/.config/chuuni/characters/<your-name>/`
2. Add audio clips using any supported naming format
3. Optionally add a `character.toml` with display name and custom lines
4. Share it as a GitHub repo with the topic **`chuuni-voice-character`**

### Development

```bash
git clone https://github.com/yourname/chuuni-voice
cd chuuni-voice
pip install -e ".[dev]"
pytest tests/ -q
```

PRs welcome for new events, player backends, and packaging improvements.

---

## License

MIT — see [LICENSE](LICENSE).
